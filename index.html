<script>
  const displayText = document.getElementById("displayText");
  const startBtn = document.getElementById("startBtn");
  const copyBtn = document.getElementById("copyBtn");
  const resetBtn = document.getElementById("resetBtn");
  const inputBox = document.getElementById("inputBox");

  // Tim nổ khi click
  document.addEventListener("click", (e) => {
    if (e.target.closest("#inputBox") || e.target.id === "playBtn") return;
    document.getElementById("hint").style.display = "none";
    const x = e.clientX, y = e.clientY;
    explode(x, y, 40, 120);
  });

  // Nhạc
  const btn = document.getElementById("playBtn");
  const audio = document.getElementById("bgm");
  btn.addEventListener("click", () => {
    audio.muted = false;
    audio.play();
    btn.style.display = "none";
  });

  // Nút bắt đầu
  startBtn.addEventListener("click", () => {
    const text = document.getElementById("message").value.trim();
    if (!text) return alert("Vui lòng nhập chữ!");
    displayText.textContent = text;
    displayText.classList.add("show"); // có transition
    explode(window.innerWidth/2, window.innerHeight/2, 120, 400);

    startBtn.style.display = "none";
    copyBtn.style.display = "inline-block";
    // Reset delay 10s
    setTimeout(() => resetBtn.style.display = "inline-block", 10000);
  });

  // Sao chép link
  copyBtn.addEventListener("click", () => {
    const text = encodeURIComponent(document.getElementById("message").value.trim());
    const url = window.location.origin + window.location.pathname + "?text=" + text;
    navigator.clipboard.writeText(url).then(()=> alert("Đã sao chép link: " + url));
  });

  // Reset
  resetBtn.addEventListener("click", () => location.reload());

  // Trang link đã sao chép
  const params = new URLSearchParams(window.location.search);
  if (params.has("text")) {
    const txt = decodeURIComponent(params.get("text"));
    displayText.textContent = txt;
    displayText.style.transition = "none";   // bỏ transition để hiện ngay
    displayText.classList.add("show");       // hiện ngay
    explode(window.innerWidth/2, window.innerHeight/2, 120, 400);

    // Ẩn toàn bộ input + reset
    inputBox.style.display = "none";
  }
</script>
